define("ace/ext/beautify",["require","exports","module","ace/token_iterator"],function(e,S,t){"use strict";function K(e,t){return-1<e.type.lastIndexOf(t+".xml")}var L=e("../token_iterator").TokenIterator;S.singletonTags=["area","base","br","col","command","embed","hr","html","img","input","keygen","link","meta","param","source","track","wbr"],S.blockTags=["article","aside","blockquote","body","div","dl","fieldset","footer","form","head","header","html","nav","ol","p","script","section","style","table","tbody","tfoot","thead","ul"],S.beautify=function(e){for(var t,r,a,o,s,n=new L(e,0,0),i=n.getCurrentToken(),c=e.getTabString(),u=S.singletonTags,l=S.blockTags,m=!1,p=!1,f=!1,h="",d="",y="",g=0,b=0,k=0,$=0,w=0,x=0,v=0,T=0,R=!1,O=!1,q=!1,C={0:0},I=[],_=!1,j=function(){t&&t.value&&"string.regexp"!==t.type&&(t.value=t.value.replace(/^\s*/,""))},B=function(){for(var e=h.length-1;0!=e&&" "===h[e];)--e;h=h.slice(0,e+1)},F=function(){h=h.trimRight(),m=!1};null!==i;){if(a=n.getCurrentTokenRow(),n.$rowTokens,t=n.stepForward(),void 0!==i){if(d=i.value,w=0,s="style"===y||"ace/mode/css"===e.$modeId,K(i,"tag-open")?(O=!0,t&&(q=-1!==l.indexOf(t.value)),"</"===d&&(q&&!m&&T<1&&T++,s&&(T=1),q=!(w=1))):K(i,"tag-close")?O=!1:K(i,"comment.start")?q=!0:K(i,"comment.end")&&(q=!1),O||T||"paren.rparen"!==i.type||"}"!==i.value.substr(0,1)||T++,a!==r&&(T=a,r&&(T-=r)),T){for(F();0<T;T--)h+="\n";m=!0,K(i,"comment")||i.type.match(/^(comment|string)$/)||(d=d.trimLeft())}if(d){if("keyword"===i.type&&d.match(/^(if|else|elseif|for|foreach|while|switch)$/)?(I[g]=d,j(),f=!0,d.match(/^(else|elseif)$/)&&h.match(/\}[\s]*$/)&&(F(),p=!0)):"paren.lparen"===i.type?(j(),"{"===d.substr(-1)&&(R=!(f=!0),O||(T=1)),"{"===d.substr(0,1)&&(p=!0,"["!==h.substr(-1)&&"["===h.trimRight().substr(-1)?(F(),p=!1):(")"===h.trimRight().substr(-1)?F:B)())):"paren.rparen"===i.type?("}"===d.substr(0,w=1)&&("case"===I[g-1]&&w++,"{"===h.trimRight().substr(-1)?F():(p=!0,s&&(T+=2))),"]"===d.substr(0,1)&&"}"!==h.substr(-1)&&"}"===h.trimRight().substr(-1)&&(p=!1,$++,F()),")"===d.substr(0,1)&&"("!==h.substr(-1)&&"("===h.trimRight().substr(-1)&&(p=!1,$++,F()),B()):"keyword.operator"!==i.type&&"keyword"!==i.type||!d.match(/^(=|==|===|!=|!==|&&|\|\||and|or|xor|\+=|.=|>|>=|<|<=|=>)$/)?"punctuation.operator"===i.type&&";"===d?(F(),j(),f=!0,s&&T++):"punctuation.operator"===i.type&&d.match(/^(:|,)$/)?(F(),j(),d.match(/^(,)$/)&&0<v&&0===x?T++:m=!(f=!0)):"support.php_tag"!==i.type||"?>"!==d||m?K(i,"attribute-name")&&h.substr(-1).match(/^\s$/)?p=!0:K(i,"attribute-equals")?(B(),j()):K(i,"tag-close")?(B(),"/>"===d&&(p=!0)):"keyword"===i.type&&d.match(/^(case|default)$/)&&_&&(w=1):(F(),p=!0):(F(),j(),f=p=!0),m&&(!i.type.match(/^(comment)$/)||d.substr(0,1).match(/^[/#]$/))&&(!i.type.match(/^(string)$/)||d.substr(0,1).match(/^['"@]$/))){if($=k,b<g)for($++,o=g;b<o;o--)C[o]=$;else g<b&&($=C[g]);for(b=g,k=$,w&&($-=w),R&&!x&&($++,R=!1),o=0;o<$;o++)h+=c}if("keyword"===i.type&&d.match(/^(case|default)$/)?!1===_&&(I[g]=d,g++,_=!0):"keyword"===i.type&&d.match(/^(break)$/)&&I[g-1]&&I[g-1].match(/^(case|default)$/)&&(g--,_=!1),"paren.lparen"===i.type&&(x+=(d.match(/\(/g)||[]).length,v+=(d.match(/\{/g)||[]).length,g+=d.length),"keyword"===i.type&&d.match(/^(if|else|elseif|for|while)$/)?(R=!0,x=0):!x&&d.trim()&&"comment"!==i.type&&(R=!1),"paren.rparen"===i.type)for(x-=(d.match(/\)/g)||[]).length,v-=(d.match(/\}/g)||[]).length,o=0;o<d.length;o++)g--,"}"===d.substr(o,1)&&"case"===I[g]&&g--;"text"==i.type&&(d=d.replace(/\s+$/," ")),p&&!m&&(B(),"\n"!==h.substr(-1)&&(h+=" ")),h+=d,f&&(h+=" "),f=p=m=!1,(K(i,"tag-close")&&(q||-1!==l.indexOf(y))||K(i,"doctype")&&">"===d)&&(T=q&&t&&"</"===t.value?-1:1),K(i,"tag-open")&&"</"===d?g--:K(i,"tag-open")&&"<"===d&&-1===u.indexOf(t.value)?g++:K(i,"tag-name")?y=d:K(i,"tag-close")&&"/>"===d&&-1===u.indexOf(y)&&g--,r=a}}i=t}h=h.trim(),e.doc.setValue(h)},S.commands=[{name:"beautify",description:"Format selection (Beautify)",exec:function(e){S.beautify(e.session)},bindKey:"Ctrl-Shift-B"}]}),window.require(["ace/ext/beautify"],function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)});